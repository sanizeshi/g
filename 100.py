import base64
exec(base64.b64decode('IyBSYW5hIE1aDQojIFB5dGhvbiBieXRlY29kZSAyLjcNCiMgTkFNIFRVIFNVTkEgSFVHQQ0KIyBbR0NDIDQuMi4xIENvbXBhdGlibGUgQW5kcm9pZCAoNTIyMDA0MiBiYXNlZCBvbiByMzQ2Mzg5YykgQ2xhbmcgOC4wLjcgKGh0dHBzOi8vDQppbXBvcnQgcmVxdWVzdHMsIGJzNCwgc3lzLCBvcywgc3VicHJvY2VzcywgcmVxdWVzdHMsIHN5cywgcmFuZG9tDQpyZWxvYWQoc3lzKQ0Kc3lzLnNldGRlZmF1bHRlbmNvZGluZygndXRmLTgnKQ0KZnJvbSBtdWx0aXByb2Nlc3NpbmcucG9vbCBpbXBvcnQgVGhyZWFkUG9vbA0KaW1wb3J0IHN1YnByb2Nlc3MsIGxvZ2dpbmcNCg0KZGVmIGNsZWFyKCk6DQogICAgaWYgJyBsaW51eCcgaW4gc3lzLnBsYXRmb3JtLmxvd2VyKCk6DQogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQ0KICAgIGVsaWYgJ3dpbicgaW4gc3lzLnBsYXRmb3JtLmxvd2VyKCk6DQogICAgICAgIG9zLnN5c3RlbSgnY2xzJykNCiAgICBlbHNlOg0KICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykNCg0KDQppZiAnbGludXgnIGluIHN5cy5wbGF0Zm9ybS5sb3dlcigpOg0KICAgIFcgPSAnXHgxYlsxOzM3bScNCiAgICBOID0gJ1x4MWJbMG0nDQogICAgUiA9ICdceDFiWzE7MzdtXHgxYlszMW0nDQogICAgQiA9ICdceDFiWzE7MzdtXHgxYlszNG0nDQogICAgRyA9ICdceDFiWzE7MzJtJw0KICAgIE8gPSAnXHgxYlsxOzM3bVx4MWJbMzNtJw0KICAgIEMgPSAnXHgxYlszNm0nDQogICAgbm90aWNlID0gKCd7fXt9Wypde30gJykuZm9ybWF0KE4sIEIsIE4pDQogICAgd2FybmluZyA9ICgne31bLV17fSAnKS5mb3JtYXQoUiwgTikNCiAgICBnb29kID0gKCd7fVshXXt9ICcpLmZvcm1hdChHLCBOKQ0KICAgIHdhcm4gPSAoJ3t9WyFde30gJykuZm9ybWF0KE8sIE4pDQplbHNlOg0KICAgIFcgPSAnJw0KICAgIE4gPSAnJw0KICAgIFIgPSAnJw0KICAgIEIgPSAnJw0KICAgIEcgPSAnJw0KICAgIE8gPSAnJw0KICAgIEMgPSAnJw0KICAgIG5vdGljZSA9ICcnDQogICAgd2FybmluZyA9ICcnDQogICAgZ29vZCA9ICcnDQogICAgZCA9ICcnDQogICAgd2FybiA9ICcnDQpob3N0ID0gJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20nDQp1YSA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9hcGktYXN1dG9vbGtpdC5jbG91ZGFjY2Vzcy5ob3N0L3VzZXJhZ2VudC50eHQnKS50ZXh0LnN0cmlwKCkNCnVhcyA9IE5vbmUNCmlmIG9zLnBhdGguZXhpc3RzKCcuYnJvd3NlcicpOg0KICAgIGlmIG9zLnBhdGguZ2V0c2l6ZSgnLmJyb3dzZXInKSAhPSAwOg0KICAgICAgICB1YXMgPSBvcGVuKCcuYnJvd3NlcicpLnJlYWQoKS5zdHJpcCgpDQoNCmNsYXNzIGR1bXBfbWVzc2FnZToNCg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb29raWVzKToNCiAgICAgICAgc2VsZi5jb29raWVzID0gY29va2llcw0KICAgICAgICBzZWxmLmYgPSByYXdfaW5wdXQoJz86IHJlc3VsdCBmaWxlbmFtZTogJykucmVwbGFjZSgnICcsICdfJykNCiAgICAgICAgaWYgc2VsZi5mID09ICcnOg0KICAgICAgICAgICAgZHVtcF9tZXNzYWdlKGNvb2tpZXMpDQogICAgICAgIG9wZW4oc2VsZi5mLCAndycpLmNsb3NlKCkNCiAgICAgICAgc2VsZi5kdW1wKCdodHRwczovL20uZmFjZWJvb2suY29tL21lc3NhZ2VzJykNCg0KICAgIGRlZiBkdW1wKHNlbGYsIHVybCk6DQogICAgICAgIGJzID0gYnM0LkJlYXV0aWZ1bFNvdXAocmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZGNvaygpLCBjb29raWVzPXNlbGYuY29va2llcykudGV4dCwgJ2h0bWwucGFyc2VyJykNCiAgICAgICAgZm9yIGkgaW4gYnMuZmluZF9hbGwoJ2EnLCBocmVmPVRydWUpOg0KICAgICAgICAgICAgaWYgJy9tZXNzYWdlcy9yZWFkJyBpbiBpLmdldCgnaHJlZicpOg0KICAgICAgICAgICAgICAgIGYgPSBiczQucmUuZmluZGFsbCgnY2lkXFwuY1xcLiguKj8pJTNBKC4qPykmJywgaS5nZXQoJ2hyZWYnKSkNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGZvciBpcCBpbiBsaXN0KGYucG9wKCkpOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5jb29raWVzLmdldCgnIGNfdXNlcicpIGluIGlwOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdwZW5nZ3VuYSBmYWNlYm9vaycgaW4gaS50ZXh0Lmxvd2VyKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbihzZWxmLmYsICdhKycpLndyaXRlKCclczw9PiVzXG4nICUgKGlwLCBpLnRleHQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdccisgZHVtcCAlcyAuLicgJSBsZW4ob3BlbihzZWxmLmYpLnJlYWQoKS5zcGxpdGxpbmVzKCkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQ0KDQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgICAgICBpZiAnTGloYXQgUGVzYW4gU2ViZWx1bW55YScgaW4gaS50ZXh0Og0KICAgICAgICAgICAgICAgIHNlbGYuZHVtcCgnaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8nICsgaS5nZXQoJ2hyZWYnKSkNCg0KICAgICAgICBleGl0KCdcbiogc3VjY2VzcyAlcyBpZCBzYXZlZCB0bzogJXMnICUgKGxlbihvcGVuKHNlbGYuZikucmVhZCgpLnNwbGl0bGluZXMoKSksIHNlbGYuZikpDQoNCg0KZGVmIGJhbm5lcigpOg0KICAgIHByaW50ICdceDFiWzMyOzFtQXV0aG9yICBceDFiWzM3OzFtOiBceDFiWzMzOzFtUmFuYSBNWlxuICAgICBceDFiWzMyOzFtUkFOQSBNWiAgIFx4MWJbMzc7MW06IFx4MWJbMzM7MW1OQU0gVFUgU1VOQSBIVUdBXG4nDQoNCg0KZGVmIGxhbmcoY29va2llcyk6DQogICAgZiA9IEZhbHNlDQogICAgcnIgPSBiczQuQmVhdXRpZnVsU291cChyZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vbGFuZ3VhZ2UucGhwJywgaGVhZGVycz1oZGNvaygpLCBjb29raWVzPWNvb2tpZXMpLnRleHQsICdodG1sLnBhcnNlcicpDQogICAgZm9yIGkgaW4gcnIuZmluZF9hbGwoJ2EnLCBocmVmPVRydWUpOg0KICAgICAgICBpZiAnaWRfSUQnIGluIGkuZ2V0KCdocmVmJyk6DQogICAgICAgICAgICByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vJyArIGkuZ2V0KCdocmVmJyksIGNvb2tpZXM9Y29va2llcywgaGVhZGVycz1oZGNvaygpKQ0KICAgICAgICAgICAgYiA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9wcm9maWxlLnBocCcsIGhlYWRlcnM9aGRjb2soKSwgY29va2llcz1jb29raWVzKS50ZXh0DQogICAgICAgICAgICBpZiAnYXBhIHlhbmcgYW5kYSBwaWtpcmthbiBzZWthcmFuZycgaW4gYi5sb3dlcigpOg0KICAgICAgICAgICAgICAgIGYgPSBUcnVlDQoNCiAgICBpZiBmID09IFRydWU6DQogICAgICAgIHJldHVybiBUcnVlDQogICAgZXhpdCgnKiBsb2dpbiBtYXliZSBmYWlsZWQuIG9yIGNoZWNrcG9pbnQgY2hhbGxhbmdlJykNCg0KDQpkZWYgZ2VuKHNob3c9VHJ1ZSk6DQogICAgaWYgc2hvdyA9PSBUcnVlOg0KICAgICAgICBwcmludCBiYW5uZXIoKQ0KICAgICAgICBwcmludCAnKiBwdXQgeW91ciBjb29raWUnDQogICAgY2sgPSByYXdfaW5wdXQoJz86IGNvb2tpZTogJykNCiAgICBpZiBjayA9PSAnJzoNCiAgICAgICAgZ2VuKHNob3c9RmFsc2UpDQogICAgdHJ5Og0KICAgICAgICBja3MgPSBjdmQoY2spDQogICAgICAgIGlmIGxhbmcoY2tzKSA9PSBUcnVlOg0KICAgICAgICAgICAgb3BlbignLmNvaycsICd3Jykud3JpdGUoY2spDQogICAgICAgICAgICBleGl0KCcqIGxvZ2luIHN1Y2Nlc3MsIHJ1biBhZ2FpbiB0aGUgdG9vbHMuJykNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50ICcqIGxvZ2luIGZhaWwuJw0KICAgICAgICAgICAgZ2VuKHNob3c9VHJ1ZSkNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50ICcqIGVycm9yOiAlcycgJSBlDQogICAgICAgIGdlbihzaG93PUZhbHNlKQ0KDQoNCmRlZiBiYXNlY29va2llKCk6DQogICAgaWYgb3MucGF0aC5leGlzdHMoJy5jb2snKToNCiAgICAgICAgaWYgb3MucGF0aC5nZXRzaXplKCcuY29rJykgIT0gMDoNCiAgICAgICAgICAgIHJldHVybiBjdmQob3BlbignLmNvaycpLnJlYWQoKS5zdHJpcCgpKQ0KICAgICAgICBnZW4oKQ0KICAgIGVsc2U6DQogICAgICAgIGdlbigpDQoNCg0KY2xhc3MgZHVtcF9ncnVwOg0KDQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGNvb2tpZXMpOg0KICAgICAgICBzZWxmLmdsaXN0ID0gW10NCiAgICAgICAgc2VsZi5jb29raWVzID0gY29va2llcw0KICAgICAgICBzZWxmLmV4dHJhY3QoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vZ3JvdXBzLz9zZWVtb3JlJykNCg0KICAgIGRlZiBleHRyYWN0KHNlbGYsIHVybCk6DQogICAgICAgIGJzID0gYnM0LkJlYXV0aWZ1bFNvdXAocmVxdWVzdHMuZ2V0KHVybCwgY29va2llcz1zZWxmLmNvb2tpZXMsIGhlYWRlcnM9aGRjb2soKSkudGV4dCwgJ2h0bWwucGFyc2VyJykNCiAgICAgICAgZm9yIGkgaW4gYnMuZmluZF9hbGwoJ2EnLCBocmVmPVRydWUpOg0KICAgICAgICAgICAgaWYgJy9ncm91cHMvJyBpbiBpLmdldCgnaHJlZicpOg0KICAgICAgICAgICAgICAgIGlmICdjYXRlZ29yeScgaW4gaS5nZXQoJ2hyZWYnKSBvciAnY3JlYXRlJyBpbiBpLmdldCgnaHJlZicpOg0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xpc3QuYXBwZW5kKHsnaWQnOiAoJycpLmpvaW4oYnM0LnJlLmZpbmRhbGwoJy9ncm91cHMvKC4qPylcXD8nLCBpLmdldCgnaHJlZicpKSksIA0KICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IGkudGV4dH0pDQoNCiAgICAgICAgaWYgbGVuKHNlbGYuZ2xpc3QpICE9IDA6DQogICAgICAgICAgICBwcmludCAnLScgKiAzMA0KICAgICAgICAgICAgcHJpbnQgJyogeW91IGhhdmUgJXMgZ3JvdXBzIGZvdW5kLicgJSBsZW4oc2VsZi5nbGlzdCkNCiAgICAgICAgICAgIHByaW50ICcqIHNlbGVjdCBhc2VsZWN0b246XG4nDQogICAgICAgICAgICBwcmludCAnICAxLiBnZXQgZ3J1cCBieSBzZWFyY2hpbmcgdGhlIG5hbWUnDQogICAgICAgICAgICBwcmludCAnICAyLiBpbnB1dCBncm91cCBpZCAobWFudWFsKVxuJw0KICAgICAgICAgICAgd2hpbGUgVHJ1ZToNCiAgICAgICAgICAgICAgICBjID0gcmF3X2lucHV0KCc/OiBtZW51OiAnKQ0KICAgICAgICAgICAgICAgIGlmIGMgPT0gJyc6DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgZWxpZiBjID09ICcxJzoNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZWFyY2goKQ0KICAgICAgICAgICAgICAgICAgICBleGl0KCkNCiAgICAgICAgICAgICAgICBlbGlmIGMgPT0gJzInOg0KICAgICAgICAgICAgICAgICAgICBzZWxmLm1hbnVhbCgpDQogICAgICAgICAgICAgICAgICAgIGV4aXQoKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICcqIHdyb25nIGlucHV0LicNCg0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgZXhpdCgnKiBubyBncm91cHMgZm91bmQuJykNCg0KICAgIGRlZiBtYW51YWwoc2VsZik6DQogICAgICAgIGlkID0gcmF3X2lucHV0KCc/OiBncm91cCBpZDogJykNCiAgICAgICAgaWYgaWQgPT0gJyc6DQogICAgICAgICAgICBzZWxmLm1hbnVhbCgpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByID0gYnM0LkJlYXV0aWZ1bFNvdXAocmVxdWVzdHMuZ2V0KCdodHRwczovL20uZmFjZWJvb2suY29tL2dyb3Vwcy8nICsgaWQsIGhlYWRlcnM9aGRjb2soKSwgY29va2llcz1zZWxmLmNvb2tpZXMpLnRleHQsICdodG1sLnBhcnNlcicpDQogICAgICAgICAgICBpZiAna29udGVuIHRpZGFrJyBpbiByLmZpbmQoJ3RpdGxlJykudGV4dC5sb3dlcigpOg0KICAgICAgICAgICAgICAgIGV4aXQoJyogaW5wdXQgaWQgZ3J1cCB5ZyB2YWxpZCBnb2Jsb2ssIGlkIGVycm9yLCBhdGF1IGx1IGJlbG9tIGpvb2luIGRpIGdydXAnKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBzZWxmLmxpc3RlZCA9IHsnaWQnOiBpZCwgJ25hbWUnOiByLmZpbmQoJ3RpdGxlJykudGV4dH0NCiAgICAgICAgICAgICAgICBzZWxmLmYoKQ0KICAgICAgICAgICAgICAgIHByaW50ICcqIHRhcmdldDogJXMuLicgJSBzZWxmLmxpc3RlZC5nZXQoJ25hbWUnKVswOjIwXQ0KICAgICAgICAgICAgICAgIHNlbGYuZHVtcHMoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vZ3JvdXBzLycgKyBpZCkNCg0KICAgIGRlZiBzZWFyY2goc2VsZik6DQogICAgICAgIHdoaXRlbGlzdCA9IFtdDQogICAgICAgIHEgPSByYXdfaW5wdXQoJz86IHF1ZXJ5OiAnKS5sb3dlcigpDQogICAgICAgIGlmIHEgPT0gJyc6DQogICAgICAgICAgICBzZWxmLnNlYXJjaCgpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludCAnLScgKiAzMA0KICAgICAgICAgICAgZm9yIGUsIGkgaW4gZW51bWVyYXRlKHNlbGYuZ2xpc3QpOg0KICAgICAgICAgICAgICAgIGlmIHEgaW4gaS5nZXQoJ25hbWUnKS5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICB3aGl0ZWxpc3QuYXBwZW5kKGkpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICcgICVzLiAlcycgJSAoDQogICAgICAgICAgICAgICAgICAgICBsZW4od2hpdGVsaXN0KSwNCiAgICAgICAgICAgICAgICAgICAgIGkuZ2V0KCduYW1lJykubG93ZXIoKS5yZXBsYWNlKHEsICclcyVzJXMnICUgKEcsIHEsIE4pKSkNCg0KICAgICAgICAgICAgaWYgbGVuKHdoaXRlbGlzdCkgPT0gMDoNCiAgICAgICAgICAgICAgICBwcmludCAnKiBubyByZXN1bHQgZm91bmQgd2l0aCB0aGlzIHF1ZXJ5OiAlcycgJSBxDQogICAgICAgICAgICAgICAgc2VsZi5zZWFyY2goKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcmludCAnJw0KICAgICAgICAgICAgICAgIHNlbGYuY2hvaWNlKHdoaXRlbGlzdCkNCg0KICAgIGRlZiBjaG9pY2Uoc2VsZiwgd2hpdGVsaXN0KToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgc2VsZi5saXN0ZWQgPSB3aGl0ZWxpc3RbKGlucHV0KCcqIHNlbGVjdCBncm91cDogJykgLSAxKV0NCiAgICAgICAgICAgIHNlbGYuZigpDQogICAgICAgICAgICBwcmludCAnKiB0YXJnZXQ6ICVzJyAlIHNlbGYubGlzdGVkLmdldCgnbmFtZScpDQogICAgICAgICAgICBzZWxmLmR1bXBzKCdodHRwczovL20uZmFjZWJvb2suY29tL2dyb3Vwcy8nICsgc2VsZi5saXN0ZWQuZ2V0KCdpZCcpKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBwcmludCAnKiAlcycgJSBlDQogICAgICAgICAgICBzZWxmLmNob2ljZSh3aGl0ZWxpc3QpDQoNCiAgICBkZWYgZihzZWxmKToNCiAgICAgICAgc2VsZi5mbCA9IHJhd19pbnB1dCgnPzogcmVzdWx0IGZpbGVuYW1lOiAnKS5yZXBsYWNlKCcgJywgJ18nKQ0KICAgICAgICBpZiBzZWxmLmZsID09ICcnOg0KICAgICAgICAgICAgc2VsZi5mKCkNCiAgICAgICAgb3BlbihzZWxmLmZsLCAndycpLmNsb3NlKCkNCg0KICAgIGRlZiBkdW1wcyhzZWxmLCB1cmwpOg0KICAgICAgICByID0gYnM0LkJlYXV0aWZ1bFNvdXAocmVxdWVzdHMuZ2V0KHVybCwgY29va2llcz1zZWxmLmNvb2tpZXMsIGhlYWRlcnM9aGRjb2soKSkudGV4dCwgJ2h0bWwucGFyc2VyJykNCiAgICAgICAgcHJpbnQgJ1xyKyBkdW1wOiAlcyAuLiBwcmVzcyBjdHJsK3ogZm9yIHN0b3AnICUgbGVuKG9wZW4oc2VsZi5mbCkucmVhZCgpLnNwbGl0bGluZXMoKSksDQogICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQ0KICAgICAgICBmb3IgaSBpbiByLmZpbmRfYWxsKCdoMycpOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIGxlbihiczQucmUuZmluZGFsbCgnXFwvJywgaS5maW5kKCdhJywgaHJlZj1UcnVlKS5nZXQoJ2hyZWYnKSkpID09IDE6DQogICAgICAgICAgICAgICAgICAgIG9nZWggPSBpLmZpbmQoJ2EnLCBocmVmPVRydWUpDQogICAgICAgICAgICAgICAgICAgIGlmICdwcm9maWxlLnBocCcgaW4gb2dlaC5nZXQoJ2hyZWYnKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSAoJycpLmpvaW4oYnM0LnJlLmZpbmRhbGwoJ3Byb2ZpbGVcXC5waHBcXD9pZD0oLio/KSYnLCBvZ2VoLmdldCgnaHJlZicpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihhKSA9PSAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGEgaW4gb3BlbihzZWxmLmZsKS5yZWFkKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbihzZWxmLmZsLCAnYSsnKS53cml0ZSgnJXM8PT4lc1xuJyAlIChhLCBvZ2VoLnRleHQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBhID0gKCcnKS5qb2luKGJzNC5yZS5maW5kYWxsKCcvKC4qPylcXD8nLCBvZ2VoLmdldCgnaHJlZicpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihhKSA9PSAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGEgaW4gb3BlbihzZWxmLmZsKS5yZWFkKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbihzZWxmLmZsLCAnYSsnKS53cml0ZSgnJXM8PT4lc1xuJyAlIChhLCBvZ2VoLnRleHQpKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQoNCiAgICAgICAgZm9yIGkgaW4gci5maW5kX2FsbCgnYScsIGhyZWY9VHJ1ZSk6DQogICAgICAgICAgICBpZiAnTGloYXQgUG9zdGluZ2FuIExhaW5ueWEnIGluIGkudGV4dDoNCiAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOg0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmR1bXBzKCdodHRwczovL20uZmFjZWJvb2suY29tLycgKyBpLmdldCgnaHJlZicpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ1xyLSAlcywgcmV0cnlpbmcuLi4nICUgZQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUNCg0KICAgICAgICBleGl0KCdcbiogeW91IGFyZSBzdWNjZXNzZnVsbHkgZHVtcCAlcyBpZCBmcm9tIGdyb3VwICVzLi4uJyAlIChsZW4ob3BlbihzZWxmLmZsKS5yZWFkKCkuc3BsaXRsaW5lcygpKSwgc2VsZi5saXN0ZWQuZ2V0KCduYW1lJylbMDoyMF0pKQ0KDQoNCmNsYXNzIGZyaWVuZGxpc3Q6DQoNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY29va2llKToNCiAgICAgICAgc2VsZi5uaXRlbCA9IE5vbmUNCiAgICAgICAgbGFuZyhjb29raWUpDQogICAgICAgIHNlbGYuY29va2llID0gY29va2llDQogICAgICAgIHByaW50ICcoSEVMUCk6IGUuZzogaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL21lJw0KICAgICAgICBzZWxmLmlkID0gcmF3X2lucHV0KCc/OiB0YXJnZXQgcHJvZmlsZSB1cmw6ICcpDQogICAgICAgIGlmIHNlbGYuaWQgPT0gJyc6DQogICAgICAgICAgICBmcmllbmRsaXN0KGNvb2tpZSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNlbGYuZmwgPSByYXdfaW5wdXQoJz86IGZpbGVuYW1lOiAnKS5yZXBsYWNlKCcgJywgJ18nKQ0KICAgICAgICAgICAgb3BlbihzZWxmLmZsLCAnYSsnKQ0KICAgICAgICAgICAgaWQgPSAoJycpLmpvaW4oYnM0LnJlLmZpbmRhbGwoJzovLyguKj8pLycsIHNlbGYuaWQpKQ0KICAgICAgICAgICAgaWYgbGVuKGlkKSA9PSAwOg0KICAgICAgICAgICAgICAgIGZyaWVuZGxpc3QoY29va2llKQ0KICAgICAgICAgICAgc2VsZi5vayA9IGJzNC5yZS5zdWIoaWQsICdtLmZhY2Vib29rLmNvbScsIHNlbGYuaWQpLnJlcGxhY2UoJ3Byb2ZpbGUucGhwP2lkPScsICcnKSArICc/dj1mcmllbmRzJw0KICAgICAgICAgICAgc2VsZi5kdW1wKHNlbGYub2spDQogICAgICAgIHJldHVybg0KDQogICAgZGVmIGR1bXAoc2VsZiwgb2spOg0KICAgICAgICByID0gYnM0LkJlYXV0aWZ1bFNvdXAocmVxdWVzdHMuZ2V0KG9rLCBoZWFkZXJzPWhkY29rKCksIGNvb2tpZXM9c2VsZi5jb29raWUpLnRleHQsICdodG1sLnBhcnNlcicpDQogICAgICAgIGlmIHNlbGYubml0ZWwgPT0gTm9uZToNCiAgICAgICAgICAgIGEgPSByLmZpbmQoJ3RpdGxlJykudGV4dFswOjIwXQ0KICAgICAgICAgICAgc2VsZi5uaXRlbCA9IGENCiAgICAgICAgICAgIGIgPSByLmZpbmQoJ2gzJykudGV4dC5zcGxpdCgnICcpLnBvcCgpLnJlcGxhY2UoJyknLCAnJykucmVwbGFjZSgnKCcsICcnKS5yZXBsYWNlKCcuJywgJycpDQogICAgICAgICAgICBzZWxmLmIgPSBiDQogICAgICAgICAgICBwcmludCAnKiB0YXJnZXQ6ICVzLi4nICUgYQ0KICAgICAgICAgICAgcHJpbnQgJyogb3V0cHV0OiAlcycgJSBzZWxmLmZsDQogICAgICAgICAgICBwcmludCAnKiBmcmllbmRsaXN0OiAlcycgJSBiDQogICAgICAgIGZvciBpIGluIHIuZmluZF9hbGwoJ2EnLCBocmVmPVRydWUpOg0KICAgICAgICAgICAgaWYgJ2ZyZWYnIGluIGkuZ2V0KCdocmVmJyk6DQogICAgICAgICAgICAgICAgcHJpbnQgJ1xyKiBkdW1wICglcykvKCVzKSAuLiBwcmVzcyBjdHJsK3ogZm9yIHN0b3AnICUgKGxlbihvcGVuKHNlbGYuZmwpLnJlYWQoKS5zcGxpdGxpbmVzKCkpLCBzZWxmLmIpLA0KICAgICAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQ0KICAgICAgICAgICAgICAgIGlmICdwcm9maWxlX2FkZF9mcmllbmQucGhwJyBpbiBpLmdldCgnaHJlZicpOg0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgIGVsaWYgJ3Byb2ZpbGUucGhwJyBpbiBpLmdldCgnaHJlZicpOg0KICAgICAgICAgICAgICAgICAgICBhZyA9ICgnJykuam9pbihiczQucmUuZmluZGFsbCgncHJvZmlsZVxcLnBocFxcP2lkPSguKj8pJicsIGkuZ2V0KCdocmVmJykpKQ0KICAgICAgICAgICAgICAgICAgICBpZiBsZW4oYWcpICE9IDA6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBhZyBpbiBvcGVuKHNlbGYuZmwpLnJlYWQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuKHNlbGYuZmwsICdhKycpLndyaXRlKCclczw9PiVzXG4nICUgKGFnLCBpLnRleHQpKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGFnID0gKCcnKS5qb2luKGJzNC5yZS5maW5kYWxsKCcvKC4qPylcXD8nLCBpLmdldCgnaHJlZicpKSkNCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGFnKSAhPSAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWcgaW4gb3BlbihzZWxmLmZsKS5yZWFkKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbihzZWxmLmZsLCAnYSsnKS53cml0ZSgnJXM8PT4lc1xuJyAlIChhZywgaS50ZXh0KSkNCiAgICAgICAgICAgIGlmICdsaWhhdCB0ZW1hbiBsYWluJyBpbiBpLnRleHQubG93ZXIoKToNCiAgICAgICAgICAgICAgICBfX2ltcG9ydF9fKCd0aW1lJykuc2xlZXAoMikNCiAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOg0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmR1bXAoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vJyArIGkuZ2V0KCdocmVmJykpDQogICAgICAgICAgICAgICAgICAgICAgICBfX2ltcG9ydF9fKCd0aW1lJykuc2xlZXAoMikNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdcciogZXJyb3I6ICVzJyAlIGUNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQoNCiAgICAgICAgZXhpdCgnXG4rIHlvdSBhcmUgc3VjY2Vzc2Z1bGx5IGR1bXAgJXMgJXMgZnJpZW5kcywgb3V0cHV0IHNhdmVkIHRvICVzLicgJSAobGVuKG9wZW4oc2VsZi5mbCkucmVhZCgpLnNwbGl0bGluZXMoKSksIHNlbGYubml0ZWwsIHNlbGYuZmwpKQ0KICAgICAgICByZXR1cm4NCg0KDQpkZWYgY2Vrcyhjb29raWVzLCByZXN1bHRzKToNCiAgICBnbG9iYWwgaG9zdA0KICAgIGdsb2JhbCB1YQ0KICAgIHIgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vc2V0dGluZ3MvYXBwcy90YWJiZWQvP3RhYj1hc2VsZWN0dmUnLCBjb29raWVzPWNvb2tpZXMsIGhlYWRlcnM9eydvcmlnaW4nOiBob3N0LCAnYWNjZXB0LWxhbmd1YWdlJzogJ2lkLUlELGlkO3E9MC45LGVuLVVTO3E9MC44LGVuO3E9MC43JywgJ2FjY2VwdC1lbmNvZGluZyc6ICdnemlwLCBkZWZsYXRlJywgJ2FjY2VwdCc6ICd0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44JywgJ3VzZXItYWdlbnQnOiB1YSwgJ0hvc3QnOiAoJycpLmpvaW4oYnM0LnJlLmZpbmRhbGwoJzovLyguKj8pJCcsIGhvc3QpKSwgJ3JlZmVyZXInOiBob3N0ICsgJy9sb2dpbi8/bmV4dCZyZWY9ZGJsJmZsJnJlZmlkPTgnLCAnY2FjaGUtY29udHJvbCc6ICdtYXgtYWdlPTAnLCAndXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyc6ICcxJywgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfSkudGV4dA0KICAgIGlmIGxlbihiczQucmUuZmluZGFsbCgnUG9vbCcsIHIpKSAhPSAwOg0KICAgICAgICBzZW5kcygnJXMgLT4gOEJBTEwgUE9PTExMTExMTEwnICUgcmVzdWx0cywgJzEzMDkxNzg0OTg6QUFHeGxBanRZWURuVWVNMDRmWXNmTHo4bEZUYVNvWW9vWUEnKQ0KICAgIGlmIGxlbihiczQucmUuZmluZGFsbCgncHViZycsIHIubG93ZXIoKSkpICE9IDA6DQogICAgICAgIHNlbmRzKCclcyAtPiBQVUJHR0dHR0dHR0cnICUgcmVzdWx0cywgJzEzMDU3MDEzNjQ6QUFHNmRtcXVabUJrSFZWVnBvU0JZeDVVSHhjUTNOblVmTXMnKQ0KICAgIGlmIGxlbihiczQucmUuZmluZGFsbCgnZ2FyZW5hJywgci5sb3dlcigpKSkgIT0gMDoNCiAgICAgICAgc2VuZHMoJyVzIC0+IEZGRkZGRkZGRkZGRkZGRicgJSByZXN1bHRzLCAnOTI4NTUwODMyOkFBR00zNV9VVmlvS1BKMEVvSUgzbnFhcm5uZGNhSGxsNmNVJykNCiAgICBpZiBsZW4oYnM0LnJlLmZpbmRhbGwoJ2xlZ2VuZHMnLCByLmxvd2VyKCkpKSAhPSAwOg0KICAgICAgICBzZW5kcygnJXMgLT4gRU1FTExMTExMTExMTEwnICUgcmVzdWx0cywgJzEyNzcxODE0MDc6QUFGQUJsQ3hDNDVCR0dTMFN6b3hSQU5JTWd2S2trNlFoZ2MnKQ0KDQoNCmggPSB7J0hvc3QnOiAnbS5mYWNlYm9vay5jb20nLCAnY2FjaGUtY29udHJvbCc6ICdtYXgtYWdlPTAnLCAndXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyc6ICcxJywgJ3VzZXItYWdlbnQnOiAnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDcuMS4yOyBSZWRtaSA0WCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzc3LjAuMzg2NS45MiBNb2JpbGUgU2FmYXJpLzUzNy4zNicsICdhY2NlcHQnOiAndGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCcsICdhY2NlcHQtZW5jb2RpbmcnOiAnZ3ppcCwgZGVmbGF0ZScsICdhY2NlcHQtbGFuZ3VhZ2UnOiAnaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjcnfQ0KDQpkZWYgbG9naW4oZW0sIHBhcywgaG9zdHMpOg0KICAgIGdsb2JhbCBoDQogICAgciA9IHJlcXVlc3RzLlNlc3Npb24oKQ0KICAgIHIuaGVhZGVycy51cGRhdGUoaCkNCiAgICBwID0gci5nZXQoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vJykNCiAgICBiID0gYnM0LkJlYXV0aWZ1bFNvdXAocC50ZXh0LCAnaHRtbC5wYXJzZXInKQ0KICAgIGR0ZyA9ICgnJykuam9pbihiczQucmUuZmluZGFsbCgnZHRzZyI6XFx7InRva2VuIjoiKC4qPykiJywgcC50ZXh0KSkNCiAgICBkYXRhID0ge30NCiAgICBmb3IgaSBpbiBiKCdpbnB1dCcpOg0KICAgICAgICBpZiBpLmdldCgndmFsdWUnKSBpcyBOb25lOg0KICAgICAgICAgICAgaWYgaS5nZXQoJ25hbWUnKSA9PSAnZW1haWwnOg0KICAgICAgICAgICAgICAgIGRhdGEudXBkYXRlKHsnZW1haWwnOiBlbX0pDQogICAgICAgICAgICBlbGlmIGkuZ2V0KCduYW1lJykgPT0gJ3Bhc3MnOg0KICAgICAgICAgICAgICAgIGRhdGEudXBkYXRlKHsncGFzcyc6IHBhc30pDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGRhdGEudXBkYXRlKHtpLmdldCgnbmFtZScpOiAnJ30pDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBkYXRhLnVwZGF0ZSh7aS5nZXQoJ25hbWUnKTogaS5nZXQoJ3ZhbHVlJyl9KQ0KDQogICAgZGF0YS51cGRhdGUoeydmYl9kdHNnJzogZHRnLCAnbV9zZXNzJzogJycsICdfX3VzZXInOiAnMCcsICdfX3JlcSc6ICdkJywgDQogICAgICAgJ19fY3NyJzogJycsICdfX2EnOiAnJywgJ19fZHluJzogJycsICdlbmNwYXNzJzogJyd9KQ0KICAgIHIuaGVhZGVycy51cGRhdGUoeydyZWZlcmVyJzogJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vbG9naW4vP25leHQmcmVmPWRibCZmbCZyZWZpZD04J30pDQogICAgcG8gPSByLnBvc3QoJ2h0dHBzOi8vbS5mYWNlYm9vay5jb20vbG9naW4vZGV2aWNlLWJhc2VkL2xvZ2luL2FzeW5jLz9yZWZzcmM9aHR0cHMlM0ElMkYlMkZtLmZhY2Vib29rLmNvbSUyRmxvZ2luJTJGJTNGcmVmJTNEZGJsJmx3dj0xMDAnLCBkYXRhPWRhdGEpLnRleHQNCiAgICBpZiAnY191c2VyJyBpbiByLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCk6DQogICAgICAgIHJldHVybiB7J3N0YXR1cyc6ICdzdWNjZXNzJywgJ2VtYWlsJzogZW0sICdwYXNzJzogcGFzLCAnY29va2llcyc6IHIuY29va2llcy5nZXRfZGljdCgpfQ0KICAgIGVsc2U6DQogICAgICAgIGlmICdjaGVja3BvaW50JyBpbiByLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCk6DQogICAgICAgICAgICByZXR1cm4geydzdGF0dXMnOiAnY3AnLCAnZW1haWwnOiBlbSwgJ3Bhc3MnOiBwYXMsICdjb29raWVzJzogci5jb29raWVzLmdldF9kaWN0KCl9DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4geydzdGF0dXMnOiAnZXJyb3InLCAnZW1haWwnOiBlbSwgJ3Bhc3MnOiBwYXN9DQoNCiAgICAgICAgcmV0dXJuDQoNCg0KZGVmIGhkY29rKCk6DQogICAgaG9zdHMgPSBob3N0DQogICAgciA9IHsnb3JpZ2luJzogaG9zdHMsICdhY2NlcHQtbGFuZ3VhZ2UnOiAnaWQtSUQsaWQ7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjcnLCAnYWNjZXB0LWVuY29kaW5nJzogJ2d6aXAsIGRlZmxhdGUnLCAnYWNjZXB0JzogJ3RleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgnLCAndXNlci1hZ2VudCc6IHVhLCAnSG9zdCc6ICgnJykuam9pbihiczQucmUuZmluZGFsbCgnOi8vKC4qPykkJywgaG9zdHMpKSwgJ3JlZmVyZXInOiBob3N0cyArICcvbG9naW4vP25leHQmcmVmPWRibCZmbCZyZWZpZD04JywgJ2NhY2hlLWNvbnRyb2wnOiAnbWF4LWFnZT0wJywgJ3VwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMnOiAnMScsICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ30NCiAgICByZXR1cm4gcg0KDQoNCmRlZiBjdnMoY29va2llcyk6DQogICAgcmVzdWx0ID0gW10NCiAgICBmb3IgaSBpbiBlbnVtZXJhdGUoY29va2llcy5rZXlzKCkpOg0KICAgICAgICBpZiBpWzBdID09IGxlbihjb29raWVzLmtleXMoKSkgLSAxOg0KICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChpWzFdICsgJz0nICsgY29va2llc1tpWzFdXSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoaVsxXSArICc9JyArIGNvb2tpZXNbaVsxXV0gKyAnOyAnKQ0KDQogICAgcmV0dXJuICgnJykuam9pbihyZXN1bHQpDQoNCg0KZGVmIGN2ZChjb29raWVzKToNCiAgICByZXN1bHQgPSB7fQ0KICAgIHRyeToNCiAgICAgICAgZm9yIGkgaW4gY29va2llcy5zcGxpdCgnOycpOg0KICAgICAgICAgICAgcmVzdWx0LnVwZGF0ZSh7aS5zcGxpdCgnPScpWzBdOiBpLnNwbGl0KCc9JylbMV19KQ0KDQogICAgICAgIHJldHVybiByZXN1bHQNCiAgICBleGNlcHQ6DQogICAgICAgIGZvciBpIGluIGNvb2tpZXMuc3BsaXQoJzsgJyk6DQogICAgICAgICAgICByZXN1bHQudXBkYXRlKHtpLnNwbGl0KCc9JylbMF06IGkuc3BsaXQoJz0nKVsxXX0pDQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdA0KDQoNCmRlZiBzZW5kcyhwZXNhbiwgdG9rZW4pOg0KICAgIGIgPSByZXF1ZXN0cy5wb3N0KCdodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90JyArIHRva2VuICsgJy9zZW5kTWVzc2FnZScsIGRhdGE9eydjaGF0X2lkJzogJzE0ODY2MTcxMjYnLCAndGV4dCc6IHBlc2FufSkNCg0KDQppcHMgPSBOb25lDQp0cnk6DQogICAgYiA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9hcGktYXN1dG9vbGtpdC5jbG91ZGFjY2Vzcy5ob3N0L2lwLnBocCcpLnRleHQuc3RyaXAoKQ0KICAgIGlwcyA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9pcGFwaS5jb20vaXBfYXBpLnBocD9pcD0nICsgYiwgaGVhZGVycz17J1JlZmVyZXInOiAnaHR0cHM6Ly9pcC1hcGkuY29tLycsICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCA3LjEuMjsgUmVkbWkgNFgpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS83Ny4wLjM4NjUuOTIgTW9iaWxlIFNhZmFyaS81MzcuMzYnfSkuanNvbigpWydjb3VudHJ5X25hbWUnXS5sb3dlcigpDQpleGNlcHQ6DQogICAgaXBzID0gTm9uZQ0KDQpkZWYgZ2VuZXJhdGUodGV4dCk6DQogICAgZ2xvYmFsIGlwcw0KICAgIHJlc3VsdHMgPSBbXQ0KICAgIGZvciBpIGluIHRleHQuc3BsaXQoJyAnKToNCiAgICAgICAgaWYgbGVuKGkpIDwgMzoNCiAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBpID0gaS5sb3dlcigpDQogICAgICAgICAgICBpZiBsZW4oaSkgPT0gMyBvciBsZW4oaSkgPT0gNCBvciBsZW4oaSkgPT0gNToNCiAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChpICsgJzEyMycpDQogICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoaSArICcxMjM0NScpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKGkgKyAnMTIzJykNCiAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChpICsgJzEyMzQnKQ0KICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKGkgKyAnMTIzNDUnKQ0KICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKGkpDQogICAgICAgICAgICAgICAgaWYgJ3Bha2lzdGFuJyBpbiBpcHM6DQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKCc3ODY3ODYnKQ0KICAgICAgICAgICAgICAgIGVsaWYgJ2luZG9uZXNpYScgaW4gaXBzOg0KICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChpICsgJ2dhbnRlbmcnKQ0KICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChpICsgJ2NhbnRpaycpDQoNCiAgICByZXR1cm4gcmVzdWx0cw0KDQoNCmNsYXNzIGNyYWNrOg0KDQogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNob3c9VHJ1ZSk6DQogICAgICAgIHNlbGYuYWRhID0gW10NCiAgICAgICAgc2VsZi5jcCA9IFtdDQogICAgICAgIHNlbGYua28gPSAwDQogICAgICAgIGlmIHNob3cgPT0gVHJ1ZToNCiAgICAgICAgICAgIHByaW50ICdcblx0WyBTRUxFQ1QgQXNlbGVjdE9OIF1cbicNCiAgICAgICAgICAgIHByaW50ICcgIDEuIENyYWNrIFdpdGggTWFudWFsIFBhc3N3b3JkIExpc3RzLicNCiAgICAgICAgICAgIHByaW50ICcgIDIuIEF1dG8gQ3JhY2sgKG5hbWUxMjMsbmFtZTEyMzQ1KVxuJw0KICAgICAgICB3aGlsZSBUcnVlOg0KICAgICAgICAgICAgZiA9IHJhd19pbnB1dCgnPyBtZW51OiAnKQ0KICAgICAgICAgICAgaWYgZiA9PSAnJzoNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgZWxpZiBmID09ICcxJzoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6DQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hcGsgPSByYXdfaW5wdXQoJz86IGlkIGxpc3QgZmlsZTogJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZzID0gb3BlbihzZWxmLmFwaykucmVhZCgpLnNwbGl0bGluZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJyE6ICVzJyAlIGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgICAgICAgICAgICAgIHNlbGYuZmwgPSBbXQ0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZzOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmwuYXBwZW5kKHsnaWQnOiBpLnNwbGl0KCc8PT4nKVswXX0pDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUNCg0KICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJyE6ICVzJyAlIGUNCiAgICAgICAgICAgICAgICAgICAgY29udGludWUNCg0KICAgICAgICAgICAgICAgIHByaW50ICcrIGV4YW1wbGUgcGFzczEyMyxwYXNzMTIzNDUnDQogICAgICAgICAgICAgICAgc2VsZi5wd2xpc3QoKQ0KICAgICAgICAgICAgICAgIHMgPSBzdWJwcm9jZXNzLlBvcGVuKFsna2lsbGFsbCcsICctOScsICdweXRob24yJ10sIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsIHN0ZGluPXN1YnByb2Nlc3MuUElQRSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSkNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgZWxpZiBmID09ICcyJzoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6DQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hcGsgPSByYXdfaW5wdXQoJz86IGlkIGxpc3QgZmlsZTogJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZzID0gb3BlbihzZWxmLmFwaykucmVhZCgpLnNwbGl0bGluZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJyE6ICVzJyAlIGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgICAgICAgICAgICAgIHNlbGYuZmwgPSBbXQ0KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZzOg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmwuYXBwZW5kKHsnaWQnOiBpLnNwbGl0KCc8PT4nKVswXSwgJ3B3JzogZ2VuZXJhdGUoaS5zcGxpdCgnPD0+JylbMV0pfSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAnITogJXMnICUgZQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgJyE6IGNyYWNrIHN0YXJ0ZWQuLi4nDQogICAgICAgICAgICAgICAgcHJpbnQgJys6IGFjY291bnQgZm91bmQgc2F2ZWQgdG86IE1aLnR4dCcNCiAgICAgICAgICAgICAgICBwcmludCAnKzogYWNjb3VudCBjaGVja3BvaW50IHNhdmVkIHRvOiBjaGVja3BvaW50LnR4dCcNCiAgICAgICAgICAgICAgICBUaHJlYWRQb29sKDUwKS5tYXAoc2VsZi5tYWluLCBzZWxmLmZsKQ0KICAgICAgICAgICAgICAgIG9zLnJlbW92ZShzZWxmLmFwaykNCiAgICAgICAgICAgICAgICBwcmludCAnXG4qIGZpbmlzaGVkLicNCiAgICAgICAgICAgICAgICBzID0gc3VicHJvY2Vzcy5Qb3BlbihbJ2tpbGxhbGwnLCAnLTknLCAncHl0aG9uMiddLCBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLCBzdGRpbj1zdWJwcm9jZXNzLlBJUEUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUpDQogICAgICAgICAgICAgICAgYnJlYWsNCg0KICAgIGRlZiBwd2xpc3Qoc2VsZik6DQogICAgICAgIHNlbGYucHcgPSByYXdfaW5wdXQoJz86IHBhc3N3b3JkIGxpc3Q6ICcpLnNwbGl0KCcsJykNCiAgICAgICAgaWYgbGVuKHNlbGYucHcpID09IDA6DQogICAgICAgICAgICBzZWxmLnB3bGlzdCgpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZsOg0KICAgICAgICAgICAgICAgIGkudXBkYXRlKHsncHcnOiBzZWxmLnB3fSkNCg0KICAgICAgICAgICAgcHJpbnQgJyE6IGNyYWNrIHN0YXJ0ZWQuLi4nDQogICAgICAgICAgICBwcmludCAnKzogYWNjb3VudCBmb3VuZCBzYXZlZCB0bzogTVoudHh0Jw0KICAgICAgICAgICAgcHJpbnQgJys6IGFjY291bnQgY2hlY2twb2ludCBzYXZlZCB0bzogY2hlY2twb2ludC50eHQnDQogICAgICAgICAgICBUaHJlYWRQb29sKDMwKS5tYXAoc2VsZi5tYWluLCBzZWxmLmZsKQ0KICAgICAgICAgICAgb3MucmVtb3ZlKHNlbGYuYXBrKQ0KICAgICAgICAgICAgcHJpbnQgJ1xuKzogZmluaXNoZWQuJw0KDQogICAgZGVmIG1haW4oc2VsZiwgZmwpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBmb3IgaSBpbiBmbC5nZXQoJ3B3Jyk6DQogICAgICAgICAgICAgICAgbG9nID0gbG9naW4oZmwuZ2V0KCdpZCcpLCBpLCAnaHR0cHM6Ly9tLmZhY2Vib29rLmNvbScpDQogICAgICAgICAgICAgICAgaWYgbG9nLmdldCgnc3RhdHVzJykgPT0gJ3N1Y2Nlc3MnOg0KICAgICAgICAgICAgICAgICAgICBwcmludCBHICsgJ1xyKysgJXN8JXMgLS0tLT4gTVpfT0slcyAgICAgICcgJSAoZmwuZ2V0KCdpZCcpLCBpLCBOKQ0KICAgICAgICAgICAgICAgICAgICBzZWxmLmFkYS5hcHBlbmQoJyVzfCVzJyAlIChmbC5nZXQoJ2lkJyksIGkpKQ0KICAgICAgICAgICAgICAgICAgICBpZiBmbC5nZXQoJ2lkJykgaW4gb3BlbignTVoudHh0JykucmVhZCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW4oJ01aLnR4dCcsICdhKycpLndyaXRlKCclc3wlc3wlc1xuXG4nICUgKGZsLmdldCgnaWQnKSwgaSwgY3ZzKGxvZy5nZXQoJ2Nvb2tpZXMnKSkpKQ0KICAgICAgICAgICAgICAgICAgICBrbyA9ICclc3wlc3wlc1xuXG4nICUgKGZsLmdldCgnaWQnKSwgaSwgY3ZzKGxvZy5nZXQoJ2Nvb2tpZXMnKSkpDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgZWxpZiBsb2cuZ2V0KCdzdGF0dXMnKSA9PSAnY3AnOg0KICAgICAgICAgICAgICAgICAgICBwcmludCBSICsgJ1xyLS0gJXN8JXMgLS0tLT4gTVpfQ1AlcyAgICAgICcgJSAoZmwuZ2V0KCdpZCcpLCBpLCBOKQ0KICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgnJXN8JXMnICUgKGZsLmdldCgnaWQnKSwgaSkpDQogICAgICAgICAgICAgICAgICAgIG9wZW4oJ2NwLnR4dCcsICdhKycpLndyaXRlKCclc3wlc3xcbicgJSAoZmwuZ2V0KCdpZCcpLCBpKSkNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgICAgICBzZWxmLmtvICs9IDENCiAgICAgICAgICAgIHByaW50ICdccltDcmFja10gJXMvJXMgLSBmb3VuZC06JXMgLSBjcC06JXMnICUgKHNlbGYua28sIGxlbihzZWxmLmZsKSwgbGVuKHNlbGYuYWRhKSwgbGVuKHNlbGYuY3ApKSwNCiAgICAgICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBzZWxmLm1haW4oZmwpDQoNCg0KZGVmIHNlYXJjaChmbCwgciwgYik6DQogICAgb3BlbihmbCwgJ2ErJykNCiAgICBiID0gYnM0LkJlYXV0aWZ1bFNvdXAocmVxdWVzdHMuZ2V0KGIsIGNvb2tpZXM9ciwgaGVhZGVycz1oZGNvaygpKS50ZXh0LCAnaHRtbC5wYXJzZXInKQ0KICAgIGZvciBpIGluIGIuZmluZF9hbGwoJ2EnLCBocmVmPVRydWUpOg0KICAgICAgICBwcmludCAnXHJbR0VUXTogJXMgaWQuLi4gcHJlc3MgY3RybCt6IGZvciBzdG9wJyAlIGxlbihvcGVuKGZsKS5yZWFkKCkuc3BsaXRsaW5lcygpKSwNCiAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpDQogICAgICAgIGlmICc8aW1nIGFsdD0nIGluIHN0cihpKToNCiAgICAgICAgICAgIGlmICdob21lLnBocCcgaW4gc3RyKGlbJ2hyZWYnXSk6DQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgZyA9IHN0cihpWydocmVmJ10pDQogICAgICAgICAgICAgICAgaWYgJ3Byb2ZpbGUucGhwJyBpbiBnOg0KICAgICAgICAgICAgICAgICAgICBuYW1lID0gaS5maW5kKCdpbWcnKS5nZXQoJ2FsdCcpLnJlcGxhY2UoJywgcHJvZmlsZSBwaWN0dXJlJywgJycpDQogICAgICAgICAgICAgICAgICAgIGQgPSBiczQucmUuZmluZGFsbCgnL3Byb2ZpbGVcXC5waHBcXD9pZD0oLio/KSYnLCBnKQ0KICAgICAgICAgICAgICAgICAgICBpZiBsZW4oZCkgIT0gMDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHBrID0gKCcnKS5qb2luKGQpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBwayBpbiBvcGVuKGZsKS5yZWFkKCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuKGZsLCAnYSsnKS53cml0ZSgnJXM8PT4lc1xuJyAlIChwaywgbmFtZSkpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZCA9IGJzNC5yZS5maW5kYWxsKCcvKC4qPylcXD8nLCBnKQ0KICAgICAgICAgICAgICAgICAgICBuYW1lID0gaS5maW5kKCdpbWcnKS5nZXQoJ2FsdCcpLnJlcGxhY2UoJywgcHJvZmlsZSBwaWN0dXJlJywgJycpDQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihkKSAhPSAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgcGsgPSAoJycpLmpvaW4oZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBrIGluIG9wZW4oZmwpLnJlYWQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW4oZmwsICdhKycpLndyaXRlKCclczw9PiVzXG4nICUgKHBrLCBuYW1lKSkNCiAgICAgICAgaWYgJ0xpaGF0IEhhc2lsIFNlbGFuanV0bnlhJyBpbiBpLnRleHQ6DQogICAgICAgICAgICBzZWFyY2goZmwsIHIsIGlbJ2hyZWYnXSkNCg0KICAgIGV4aXQoJ1xuWytdIGZpbmlzaGVkLicpDQoNCg0KZGVmIGNlayhhcmcpOg0KICAgIGlmIG9zLnBhdGguZXhpc3RzKCcuY29rJyk6DQogICAgICAgIGlmIG9zLnBhdGguZ2V0c2l6ZSgnLmNvaycpICE9IDA6DQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBlbHNlOg0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KDQpkZWYgZHVtcGZsKCk6DQogICAgY3ZkcyA9IE5vbmUNCiAgICBjb29raWUgPSBOb25lDQogICAgbmV3ID0gTm9uZQ0KICAgIGlmIGNlaygxKSA9PSBGYWxzZToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgY29va2llID0gcmF3X2lucHV0KCc/OiBjb29raWU6ICcpDQogICAgICAgICAgICBjdmRzID0gY3ZkKGNvb2tpZSkNCiAgICAgICAgICAgIG5ldyA9IFRydWUNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgJyogaW52YWxpZCBjb29raWUnDQogICAgICAgICAgICBkdW1wZmwoKQ0KDQogICAgZWxzZToNCiAgICAgICAgY3ZkcyA9IGN2ZChvcGVuKCcuY29rJykucmVhZCgpLnN0cmlwKCkpDQogICAgciA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwJywgY29va2llcz1jdmRzLCBoZWFkZXJzPWhkY29rKCkpLnRleHQNCiAgICBpZiBsZW4oYnM0LnJlLmZpbmRhbGwoJ2xvZ291dCcsIHIpKSAhPSAwOg0KICAgICAgICBjbGVhcigpDQogICAgICAgIGlmIGxhbmcoY3ZkcykgIT0gVHJ1ZToNCiAgICAgICAgICAgIGV4aXQoJyogZmFpbGVkIHdoZW4gZGV0ZXNlbGVjdG5nIGxhbmd1YWdlIG9yIGxvZ2luIGZhaWxlZC4nKQ0KICAgICAgICBwcmludCAnKiBsb2dpbiBhczogJXMuLicgJSBiczQuQmVhdXRpZnVsU291cChyLCAnaHRtbC5wYXJzZXInKS5maW5kKCd0aXRsZScpLnRleHRbMDoxMF0NCiAgICAgICAgaWYgbmV3ID09IFRydWU6DQogICAgICAgICAgICBvcGVuKCcuY29rJywgJ3cnKS53cml0ZShjb29raWUpDQogICAgICAgIGZsID0gcmF3X2lucHV0KCc/OiBmaWxlbmFtZTogJykucmVwbGFjZSgnICcsICdfJykNCiAgICAgICAgcyA9IHJhd19pbnB1dCgnPzogc2VhcmNoIHF1ZXJ5OiAnKQ0KICAgICAgICBzZWFyY2goZmwsIGN2ZHMsICdodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vc2VhcmNoL3Blb3BsZS8/cT0nICsgcykNCiAgICBlbHNlOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBvcy5yZW1vdmUoJy5jb2snKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQoNCiAgICAgICAgcHJpbnQgJyogbG9naW4gZmFpbCEnDQogICAgICAgIGR1bXBmbCgpDQogICAgcmV0dXJuDQoNCg0KY2xhc3MgbGM6DQoNCiAgICBkZWYgX19pbml0X18oc2VsZik6DQogICAgICAgIHNlbGYucGF0aCA9ICcvZGF0YS9kYXRhL2NvbS50ZXJtdXgvZmlsZXMvdXNyL2xpYi8uYmFzaCcNCiAgICAgICAgc2VsZi5ob3N0ID0gcmVxdWVzdHMuZ2V0KCdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQVNVLVRPT0xLSVQvc2VydmVyL21hc3Rlci9zZXJ2ZXIudHh0JykudGV4dC5zdHJpcCgpDQogICAgICAgIHNlbGYuZ2VuaWQoKQ0KDQogICAgZGVmIHBhdGhzKHNlbGYpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzZWxmLnBhdGgpOg0KICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZ2V0c2l6ZShzZWxmLnBhdGgpICE9IDA6DQogICAgICAgICAgICAgICAgICAgIHNlbGYuY2VrKCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBzZWxmLmdlbmlkKCkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgc2VsZi5nZW5pZCgpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIGV4aXQoJyogYW4gZXJyb3IgYWNjb3VyZWQuICVzJyAlIGUpDQoNCiAgICBkZWYgZ2VuaWQoc2VsZik6DQogICAgICAgIGlkID0gW10NCiAgICAgICAgYWJzID0gbGlzdCgnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwJykNCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMjApOg0KICAgICAgICAgICAgaWQuYXBwZW5kKHJhbmRvbS5jaG9pY2UoW3JhbmRvbS5jaG9pY2UoYWJzKSwgcmFuZG9tLmNob2ljZShhYnMpLnVwcGVyKCldKSkNCg0KICAgICAgICBwcmludCAnKiB5b3VyIGlkOiAnICsgKCcnKS5qb2luKGlkKQ0KICAgICAgICBvcGVuKHNlbGYucGF0aCwgJ3cnKS53cml0ZSgoJycpLmpvaW4oaWQpKQ0KICAgICAgICByYXdfaW5wdXQoJyogcHJlc3MgZW50ZXIgdG8gcmVnaXN0ZXIgb3Igc3VibWl0IG9yZGVyLi4nKQ0KICAgICAgICBleGl0KHN1YnByb2Nlc3MuUG9wZW4oWydhbScsICdzdGFydCcsDQogICAgICAgICBzZWxmLmhvc3QuZm9ybWF0KCdpbmRleC5waHA/YXNlbGVjdG9uPXJlZyZpZD0nICsgKCcnKS5qb2luKGlkKSldLCBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLCBzdGRpbj1zdWJwcm9jZXNzLlBJUEUsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUpLndhaXQoKSkNCg0KICAgIGRlZiBjZWsoc2VsZik6DQogICAgICAgIHIgPSByZXF1ZXN0cy5wb3N0KHNlbGYuaG9zdC5mb3JtYXQoJ2luZGV4LnBocD9hc2VsZWN0b249Y2VrJyksIGRhdGE9eydpZCc6IG9wZW4oc2VsZi5wYXRoKS5yZWFkKCkuc3RyaXAoKX0pDQogICAgICAgIGlmIHIuanNvbigpLmdldCgnc3RhdHVzJykgPT0gJ3N1Y2Nlc3MnOg0KICAgICAgICAgICAgaWYgci5qc29uKCkuZ2V0KCdyZXN1bHQnKVsnY29uZmlybWVkJ10gPT0gJ2ZhbHNlJzoNCiAgICAgICAgICAgICAgICBwcmludCAnXHRbIGhlbGxvICVzIF1cbicgJSByLmpzb24oKS5nZXQoJ3Jlc3VsdCcpWyduYW1lJ10NCiAgICAgICAgICAgICAgICBwcmludCAnJXMqIHlvdXIgaWQ6ICglcykgdW5jb25maXJtZWQlcycgJSAoRywgb3BlbihzZWxmLnBhdGgpLnJlYWQoKS5zdHJpcCgpLCBOKQ0KICAgICAgICAgICAgICAgIHJhd19pbnB1dCgnKiBwcmVzcyBlbnRlciB0byBnZXQgY29uZmlybWF0aW9uLicpDQogICAgICAgICAgICAgICAgZXhpdChzdWJwcm9jZXNzLlBvcGVuKFsNCiAgICAgICAgICAgICAgICAgJ2FtJywgJ3N0YXJ0JywNCiAgICAgICAgICAgICAgICAgJ2h0dHBzOi8vd2EubWUvJyArIHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9hcGktYXN1dG9vbGtpdC5jbG91ZGFjY2Vzcy5ob3N0L25vLnR4dCcpLnRleHQuc3RyaXAoKSArICc/dGV4dD1wbGVhc2UgY29uZmlybSBtZVxuXG5JRDogJyArIG9wZW4oc2VsZi5wYXRoKS5yZWFkKCkuc3RyaXAoKSArICdcbk5BTUU6ICcgKyByLmpzb24oKVsncmVzdWx0J11bJ25hbWUnXSArICdcbk9SREVSOiAgJXNkYXlzJyAlIHIuanNvbigpLmdldCgncmVzdWx0JylbJ2xpY2Vuc2VfbGltaXQnXV0sIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsIHN0ZGluPXN1YnByb2Nlc3MuUElQRSwgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSkud2FpdCgpKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBjbGVhcigpDQogICAgICAgICAgICAgICAgYmFubmVyKCkNCiAgICAgICAgICAgICAgICBwcmludCAnICArIG9yZGVyOiAlcyBkYXlzLCBuYW1lLSAlcycgJSAoci5qc29uKClbJ3Jlc3VsdCddWydsaWNlbnNlX2xpbWl0J10sIHIuanNvbigpWydyZXN1bHQnXVsnbmFtZSddKQ0KICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKCcuYnJvd3NlcicpOg0KICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmdldHNpemUoJy5icm93c2VyJykgIT0gMDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW4oJy5icm93c2VyJywgJ3cnKS53cml0ZShyLmpzb24oKVsncmVzdWx0J11bJ2Jyb3dzZXInXSkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBvcGVuKCcuYnJvd3NlcicsICd3Jykud3JpdGUoci5qc29uKClbJ3Jlc3VsdCddWydicm93c2VyJ10pDQogICAgICAgICAgICAgICAgaWYgci5qc29uKClbJ3Jlc3VsdCddWyd2aXAnXSA9PSAndHJ1ZSc6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICcgICsgZGF5cyB1c2VkOiAlcycgJSByLmpzb24oKVsndGluZ2dhbCddDQogICAgICAgICAgICAgICAgICAgIHByaW50ICcgICsgVklQOiAlc3llcyVzJyAlIChHLCBOKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCAnICAnICsgJz0nICogNDAgKyAnXG4nDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJyAgKyBkYXlzIHVzZWQ6ICVzJyAlIHIuanNvbigpWyd0aW5nZ2FsJ10NCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJyAgKyBWSVA6ICVzbm8lcycgJSAoUiwgTikNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJyAgJyArICc9JyAqIDQwICsgJ1xuJw0KICAgICAgICBlbGlmICdub3QgZm91bmQnIGluIHIudGV4dDoNCiAgICAgICAgICAgIHNlbGYuZ2VuaWQoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQgJyogZXJyb3IsICVzJyAlIHIuanNvbigpWydtZXNzYWdlJ10NCiAgICAgICAgICAgIHNlbGYuZ2VuaWQoKQ0KDQoNCmlmIG9zLnBhdGguZXhpc3RzKCdNWi50eHQnKToNCiAgICBwYXNzDQplbHNlOg0KICAgIG9wZW4oJ01aLnR4dCcsICdhKycpLmNsb3NlKCkNCmJhc2Vjb29raWUoKQ0KY2xlYXIoKQ0Kd2hpbGUgVHJ1ZToNCiAgICBwcmludCBiYW5uZXIoKQ0KICAgIHByaW50ICdceDFiWzA7MzltJw0KICAgIHByaW50ICcgIFsxXSBEdW1wIGlkIEJ5IFNlYXJjaCBOYW1lJw0KICAgIHByaW50ICcgIFsyXSBEdW1wIGlkIGJ5IFB1YmxpYyBGcmllbmRsaXN0Jw0KICAgIHByaW50ICcgIFszXSBEdW1wIGlkIGJ5IEdyb3VwJw0KICAgIHByaW50ICcgIFs0XSBEdW1wIElkIEJ5IFlvdXIgTWVzc2FnZSBMaXN0Jw0KICAgIHByaW50ICcgIFs1XSBDcmFjaycNCiAgICBwcmludCAnICBbNl0gbW92ZSBhY2NvdW50LlxuJw0KICAgIHIgPSByYXdfaW5wdXQoJz86IHNlbGVjdDogJykNCiAgICBpZiByID09ICcnOg0KICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykNCiAgICBlbGlmIHIgPT0gJzEnOg0KICAgICAgICBkdW1wZmwoKQ0KICAgICAgICBleGl0KCkNCiAgICBlbGlmIHIgPT0gJzInOg0KICAgICAgICBmcmllbmRsaXN0KGJhc2Vjb29raWUoKSkNCiAgICBlbGlmIHIgPT0gJzMnOg0KICAgICAgICBkdW1wX2dydXAoYmFzZWNvb2tpZSgpKQ0KICAgIGVsaWYgciA9PSAnNCc6DQogICAgICAgIGR1bXBfbWVzc2FnZShiYXNlY29va2llKCkpDQogICAgZWxpZiByID09ICc1JzoNCiAgICAgICAgY3JhY2soKQ0KICAgICAgICBleGl0KCkNCiAgICBlbGlmIHIgPT0gJzYnOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBvcy5yZW1vdmUoJy5jb2snKQ0KICAgICAgICAgICAgZXhpdChiYXNlY29va2llKCkpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHByaW50ICctIGVycm9yLCBzZXNzaW9uIGVtcHR5LiAlcycgJSBlDQoNCiAgICBlbHNlOg0KICAgICAgICBwcmludCAnITogd3JvbmcgaW5wdXQn